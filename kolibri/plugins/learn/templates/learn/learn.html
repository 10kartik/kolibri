{% extends "kolibri/base.html" %}
{% load learn_tags %}

{% block content %}
  <script>
    {{kolibri}}.resources.ContentNodeResource.setChannel("{{ channel_id }}");
    var root_node = JSON.parse("{{ rootnode|escapejs }}");
    var root_node_pk = String(root_node.pk);
    var model = {{kolibri}}.resources.ContentNodeResource.createModel(root_node);
    model.synced = true;
    var collection = {{kolibri}}.resources.ContentNodeResource.getCollection({parent: root_node_pk}, JSON.parse("{{ nodes|escapejs }}"));
    collection.synced = true;

    // Get list of channels.
    var channelCollection = {{kolibri}}.resources.ContentNodeResource.getCollection({}, JSON.parse("{{ channels|escapejs }}"));
    channelCollection.synced = true;

    var channels = JSON.parse("{{ channels | escapejs }}");
    var defaultChannelId = "7199dde6-95db-4ee4-ab39-2222d5af1e51"; // TODO: API also fetches user-selected default channel.
    var currentChannelId = defaultChannelId;
    var root_pk = getChannelRootPk(channels, currentChannelId);
    function getChannelRootPk(channels, channelId) {
      for (channel in channels) {
        if (channels[channel].id == channelId) {
          return channels[channel].root_pk;
        }
      }
    }
    // {{kolibri}}.resources.ChannelResource.;
  </script>
  {% learn_async_assets %}
  {% learn_assets %}
{% endblock %}
